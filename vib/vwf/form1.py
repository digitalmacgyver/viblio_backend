#!/usr/bin/env python

# Create hello world HIT.



def _get_sample_tracks():
    return [
                {
                    "faces": [
                        {
                            "Genderconfidence": 34,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_0_2.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "2470109b93cc87d8d52c18c39cc6a20b",
                            "GlassesConfidence": 40,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 9,
                            "DarkGlassesConfidence": 12,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 66.6208,
                            "face_id": 1,
                            "Blink": "no",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 26,
                            "Glasses": "No"
                            },
                        {
                            "Genderconfidence": 38,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_0_3.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "2a7297129393d0a70f08cc4ab672d745",
                            "GlassesConfidence": 85,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 255,
                            "DarkGlassesConfidence": 61,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 62.3178,
                            "face_id": 2,
                            "Blink": "no",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 12,
                            "Glasses": "No"
                            },
                        {
                            "Genderconfidence": 33,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_0_4.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "796b65e2fdec46ab6eb716d38a5dd10a",
                            "GlassesConfidence": 40,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 10,
                            "DarkGlassesConfidence": 26,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 65.8241,
                            "face_id": 3,
                            "Blink": "yes",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 47,
                            "Glasses": "No"
                            }
                        ],
                    "visiblity_info": [
                        {
                            "end_frame": 5666,
                            "start_frame": 633
                            },
                        {
                            "end_frame": 8366,
                            "start_frame": 5733
                            }
                        ],
                    "track_id": 0
                    },
                {
                    "faces": [
                        {
                            "Genderconfidence": 255,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_1_1.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "e0b4d4acbf962226fb78b94dcc6ec0de",
                            "GlassesConfidence": 36,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 31,
                            "DarkGlassesConfidence": 255,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 59.0595,
                            "face_id": 0,
                            "Blink": "yes",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 100,
                            "Glasses": "No"
                            },
                        {
                            "Genderconfidence": 25,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_1_2.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "91535fe780fb30e1a7ee71df3922d885",
                            "GlassesConfidence": 75,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 54,
                            "DarkGlassesConfidence": 35,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 76.1929,
                            "face_id": 1,
                            "Blink": "no",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 100,
                            "Glasses": "No"
                            },
                        {
                            "Genderconfidence": 50,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_1_3.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "3ddc10d58070ead9639de9cc486b6ba4",
                            "GlassesConfidence": 80,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 81,
                            "DarkGlassesConfidence": 46,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 71.3377,
                            "face_id": 2,
                            "Blink": "no",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 56,
                            "Glasses": "No"
                            },
                        {
                            "Genderconfidence": 48,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_1_4.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "34e05fed65ed8ea7db592d78aa43529e",
                            "GlassesConfidence": 70,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 67,
                            "DarkGlassesConfidence": 30,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 67.2394,
                            "face_id": 3,
                            "Blink": "no",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 83,
                            "Glasses": "No"
                            },
                        {
                            "Genderconfidence": 74,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_1_5.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "06a38b5f10954e68d345a66de8b4057c",
                            "GlassesConfidence": 70,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 72,
                            "DarkGlassesConfidence": 23,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 68.1247,
                            "face_id": 4,
                            "Blink": "no",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 85,
                            "Glasses": "No"
                            }
                        ],
                    "visiblity_info": [
                        {
                            "end_frame": 15533,
                            "start_frame": 833
                            },
                        {
                            "end_frame": 37066,
                            "start_frame": 36433
                            },
                        {
                            "end_frame": 48600,
                            "start_frame": 20000
                            },
                        {
                            "end_frame": 48733,
                            "start_frame": 48666
                            },
                        {
                            "end_frame": 61600,
                            "start_frame": 40533
                            },
                        {
                            "end_frame": 64933,
                            "start_frame": 62000
                            },
                        {
                            "end_frame": 65100,
                            "start_frame": 65000
                            },
                        {
                            "end_frame": 66933,
                            "start_frame": 65333
                            },
                        {
                            "end_frame": 73866,
                            "start_frame": 73500
                            },
                        {
                            "end_frame": 74100,
                            "start_frame": 74000
                            },
                        {
                            "end_frame": 75500,
                            "start_frame": 75333
                            },
                        {
                            "end_frame": 76500,
                            "start_frame": 75666
                            },
                        {
                            "end_frame": 76700,
                            "start_frame": 76666
                            }
                        ],
                    "track_id": 1
                    },
                {
                    "faces": [
                        {
                            "Genderconfidence": 20,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_2_1.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "c87428eda6e41e4760a1517b8402731c",
                            "GlassesConfidence": 43,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 66,
                            "DarkGlassesConfidence": 46,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 62.4248,
                            "face_id": 0,
                            "Blink": "no",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 90,
                            "Glasses": "No"
                            },
                        {
                            "Genderconfidence": 62,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_2_2.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "6ad0dab4710e89335f902ca739d6af35",
                            "GlassesConfidence": 53,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 66,
                            "DarkGlassesConfidence": 23,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 65.7695,
                            "face_id": 1,
                            "Blink": "no",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 45,
                            "Glasses": "No"
                            },
                        {
                            "Genderconfidence": 255,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_2_3.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "9ccb02d540f10c67141a55644c660242",
                            "GlassesConfidence": 43,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 62,
                            "DarkGlassesConfidence": 48,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 60.3161,
                            "face_id": 2,
                            "Blink": "no",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 71,
                            "Glasses": "No"
                            },
                        {
                            "Genderconfidence": 255,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_2_4.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "029ffe1ead992e0d8bb0eaae94253b8d",
                            "GlassesConfidence": 52,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 39,
                            "DarkGlassesConfidence": 27,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 66.6435,
                            "face_id": 3,
                            "Blink": "no",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 88,
                            "Glasses": "No"
                            },
                        {
                            "Genderconfidence": 53,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_2_5.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "a6a2b37a7371bec479a361a3ec27c5e9",
                            "GlassesConfidence": 48,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 79,
                            "DarkGlassesConfidence": 35,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 68.2131,
                            "face_id": 4,
                            "Blink": "no",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 100,
                            "Glasses": "No"
                            }
                        ],
                    "visiblity_info": [
                        {
                            "end_frame": 34266,
                            "start_frame": 19433
                            },
                        {
                            "end_frame": 37600,
                            "start_frame": 26033
                            },
                        {
                            "end_frame": 92566,
                            "start_frame": 37833
                            },
                        {
                            "end_frame": 94000,
                            "start_frame": 92600
                            },
                        {
                            "end_frame": 100366,
                            "start_frame": 94266
                            }
                        ],
                    "track_id": 2
                    },
                {
                    "faces": [
                        {
                            "Genderconfidence": 255,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_3_1.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "451581b56c136ded16b73fa52c165845",
                            "GlassesConfidence": 48,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 30,
                            "DarkGlassesConfidence": 255,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 59.6994,
                            "face_id": 0,
                            "Blink": "yes",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 61,
                            "Glasses": "No"
                            },
                        {
                            "Genderconfidence": 43,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_3_2.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "d46150e213c82235339c9444799d59cb",
                            "GlassesConfidence": 46,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 7,
                            "DarkGlassesConfidence": 29,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 66.2533,
                            "face_id": 1,
                            "Blink": "yes",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 88,
                            "Glasses": "No"
                            },
                        {
                            "Genderconfidence": 32,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_3_3.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "bf47c110aff46390e31641f5cc623a80",
                            "GlassesConfidence": 59,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 77,
                            "DarkGlassesConfidence": 19,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 66.9296,
                            "face_id": 2,
                            "Blink": "no",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 65,
                            "Glasses": "No"
                            },
                        {
                            "Genderconfidence": 42,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_3_4.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "b38f4182c2fdbe8e9a50ab335e0cdb87",
                            "GlassesConfidence": 55,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 70,
                            "DarkGlassesConfidence": 44,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 65.6005,
                            "face_id": 3,
                            "Blink": "no",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 82,
                            "Glasses": "No"
                            },
                        {
                            "Genderconfidence": 255,
                            "width": 65,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_3_5.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "ece97a5dfb3562bd72118e9cafbe04d2",
                            "GlassesConfidence": 60,
                            "height": 65,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 90,
                            "DarkGlassesConfidence": 27,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 69.3573,
                            "face_id": 4,
                            "Blink": "no",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 95,
                            "Glasses": "No"
                            }
                        ],
                    "visiblity_info": [
                        {
                            "end_frame": 95733,
                            "start_frame": 83933
                            },
                        {
                            "end_frame": 96733,
                            "start_frame": 96600
                            }
                        ],
                    "track_id": 3
                    },
                {
                    "faces": [
                        {
                            "Genderconfidence": 21,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_4_2.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "94c946a9e6a387401cdf30ef57f681e2",
                            "GlassesConfidence": 21,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 26,
                            "DarkGlassesConfidence": 9,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 53.7607,
                            "face_id": 1,
                            "Blink": "no",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 9,
                            "Glasses": "No"
                            },
                        {
                            "Genderconfidence": 40,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_4_3.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "0da080c8095dc64224a72cfa9e351aa0",
                            "GlassesConfidence": 26,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 16,
                            "DarkGlassesConfidence": 59,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 57.9286,
                            "face_id": 2,
                            "Blink": "no",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 24,
                            "Glasses": "No"
                            },
                        {
                            "Genderconfidence": 255,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_4_4.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "5696d510136b19f9d86eb961ed97c0de",
                            "GlassesConfidence": 80,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 17,
                            "DarkGlassesConfidence": 45,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 53.6297,
                            "face_id": 3,
                            "Blink": "no",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 85,
                            "Glasses": "No"
                            }
                        ],
                    "visiblity_info": [
                        {
                            "end_frame": 100366,
                            "start_frame": 94033
                            }
                        ],
                    "track_id": 4
                    }
                ]


form_front = '''
  <form name='mturk_form' method='post' id='mturk_form' action='https://www.mturk.com/mturk/externalSubmit'>
'''

form_back = '''
  <input type='hidden' value='' name='assignmentId' id='assignmentId'/>
  <p><input type='submit' id='submitButton' value='Submit' /></p>
  </form>
'''

html_back = '''
  <script language='Javascript'>turkSetAssignmentID();</script>
 </body>
</html>
]]>
  </HTMLContent>
  <FrameHeight>%d</FrameHeight>
</HTMLQuestion>
'''

html_front = '''<HTMLQuestion xmlns="http://mechanicalturk.amazonaws.com/AWSMechanicalTurkDataSchemas/2011-11-11/HTMLQuestion.xsd">
  <HTMLContent><![CDATA[
<!DOCTYPE html>
<html>
 <head>
  <meta http-equiv='Content-Type' content='text/html; charset=UTF-8'/>
  <script type='text/javascript' src='https://s3.amazonaws.com/mturk-public/externalHIT_v1.js'></script>
 </head>
 <body>
'''

def _get_question_html_for_track( track, max_faces ):
    face_count = len( track['faces'] )
    
    html = ""

    track_id = track['track_id']

    if face_count: 
        html = "<tr>"
        html += '<td rowspan="4">Group %d</td>' % ( track_id )

        for i in range( face_count ):
            face = track['faces'][i]
            server = "http://staging.viblio.com/s/ip/"
            if face['s3_bucket'] != "viblio-uploaded-files":
                server = "http://prod.viblio.com/s/ip/"

            html += '<td rowspan="4"><img src="%s%s" height="50" width="50" alt="Img. %s" /></td>' % ( server, face['s3_key'] , i )


        for i in range( face_count, max_faces ):
            html += '<td rowspan="4"></td>'

        html += '<td><input type="radio" name="answer" value="%d_notface" /></td>' % track_id
        html += '<td>One of the images for Group %d is not a face</td>' % track_id

        html += "</tr>"

        html += '<tr>'
        html += '<td><input type="radio" name="answer" value="%d_twoface" /></td>' % track_id
        html += '<td>The faces for Group %d include two or more different people</td>' % track_id
        html += '</tr>'
        html += '<tr>'
        html += '<td><input type="radio" name="answer" value="%d_new" /></td>' % track_id
        html += '<td>Ignoring any groups that had non-faces, or multiple different people, this is the lowest numbered Group that the pictured person appears in.</td>'
        html += '</tr>'
        html += '<tr>'
        if track_id == 0:
            html += '<td></td><td></td>'
        else:
            html += '<td><input type="number" name="merge_track_%d" min="0" max="%d" size="2" /></td>' % ( track_id, track_id - 1 )
            html += '<td>If none of the above were true, enter the lowest numbered Group that also has this person to the left (Ignore any groups that had non-faces, or multiple differnent people)</td>'
        html += '</tr>'

    return html

def _get_question( tracks ):
    html = html_front
    html += form_front
    max_faces = 0
    for track in tracks:
        if max_faces < len( track['faces'] ):
            max_faces = len( track['faces'] )
        
    html += '<table border="1px">'
    for track in tracks[:2]:
        html += _get_question_html_for_track( track, max_faces )
    html += '</table>'
    html += form_back
    #html += html_back % ( 100*len( tracks ) + 100 ) 
    html += html_back % 500
    
    return html

from vib.thirdParty.mturkcore import MechanicalTurk

mt = MechanicalTurk( 
    { 
        'use_sandbox'           : True, 
        'stdout_log'            : True, 
        'aws_key'     : 'AKIAJHD46VMHB2FBEMMA',
        'aws_secret_key' : 'gPKpaSdHdHwgc45DRFEsZkTDpX9Y8UzJNjz0fQlX',
        } 
    )


MergeHITTypeId = '2PCIA0RYNJ96UXSXBA2MMTUHYKA837'

media_uuid = '123462'

tracks = _get_sample_tracks()

create_options = {
    # DEBUG - get this from configuration
    'HITTypeId' : MergeHITTypeId,
    'LifetimeInSeconds' : 36*60*60,
    'RequesterAnnotation' : media_uuid,
    'UniqueRequestToken' : 'merge-' + media_uuid,
    'Question' : _get_question( tracks )
    }

print create_options['Question']

#import pdb
#pdb.set_trace()

result = mt.create_request( 'CreateHIT', create_options )
print "Result was %s" % result

hit_id = None
try:
    hit_id = result['CreateHITResponse']['HIT']['HITId']
except:
    # Handle the case where this hit already exists.
    hit_id = result['CreateHITResponse']['HIT']['Request']['Errors']['Error']['Data'][1]['Value']

get_options = {
    'HITId' : hit_id
    }

#result = mt.create_request( 'GetHIT', get_options )
#print "Result was %s" % result

get_assignments_options = {
    'HITId' : hit_id
    }


def _get_track_html( track ):
    return '''
  <table>
    <tr>
      <td><img src="http://web.cacs.louisiana.edu/~cice/mesh/mary.jpg" height="50" width="50" /></td>
      <td><img src="http://imalbum.aufeminin.com/album/D20130702/hairstyles-for-oval-shaped-faces1-921202_H165451_S.jpg" height="50" width="50" /></td>
      <td><img src="https://si0.twimg.com/profile_images/3528477267/a5d136b09d331805e88d24f69c0d0fdb.jpeg" height="50" width="50" /></td>
      <td><img src="http://31.media.tumblr.com/avatar_8f99bee205d9_64.png" height="50" width="50" /></td>
      <td><img src="http://imalbum.aufeminin.com/album/D20130621/919480_YATQJ5UWKKEBPFBMUSOT8XOYQYADGF_hairstyles-for-square-faces1_H000444_S.jpg" height="50" width="50" /></td>
    </tr>
  </table>
'''


def _get_form_html( tracks ):
    return '''  
    <p>Select the first true statement below:</p>


    <table border="1px">
      <tr>
        <td><input type="radio" name="answer" value="not_face" /></td>
        <td>One of the above images is not a face</td>
      </tr>  
      <tr>
        <td><input type="radio" name="answer" value="two_face" /></td>
        <td>The face images above are of two or more different people.</td>
      </tr>  
      <tr>
        <td><input type="radio" name="answer" value="recognized_face" /></td>
        <td>The images above are of this person:<img src="https://si0.twimg.com/profile_images/378800000060141540/c140d338c308894eb0475045010aeeb5.jpeg" height="50" width="50"/></td>
      </tr>  
      <tr>
        <td></td>
        <td>If the images above are of one of the people below, click the button under the person:</td>
      <tr>
      <tr>
        <td></td>
        <td>
        <table>
          <tr>
            <td><img src="https://si0.twimg.com/profile_images/378800000598797835/996bbcad7ddf2277bd5352dcf165671a_normal.jpeg" height="50" width="50"/></td>
            <td><img src="http://imalbum.aufeminin.com/album/D20130614/hairstyles-for-heartshaped-faces1-918395_H125134_S.jpg" height="50" width="50"/></td>
            <td><img src="https://si0.twimg.com/profile_images/3312497315/4132de7875e8184ff04b432b40fc012f_normal.jpeg" height="50" width="50"/></td>
            <td><img src="https://lh6.googleusercontent.com/-6tvTjoGnBCI/AAAAAAAAAAI/AAAAAAAAAAA/rO4GhBZXLT8/s48-c-k/photo.jpg" height="50" width="50"/></td>
            <td><img src="http://www.cs.indiana.edu/~kinzler/images/kinzler_icon.gif" height="50" width="50"/></td>
            <td><img src="http://web.cacs.louisiana.edu/~cice/mesh/jane.jpg" height="50" width="50"/></td>
            <td><img src="http://s4.evcdn.com/images/block/I0-001/013/818/515-1.jpeg_/many-faces-hildegard-bingen-new-doctor-church-15.jpeg" height="50" width="50"/></td>
            <td><img src="https://lh5.googleusercontent.com/-jCBTc4m12gE/AAAAAAAAAAI/AAAAAAAAAAA/htwrLaSvByU/s48-c-k/photo.jpg" height="50" width="50"/></td>
            <td><img src="http://imalbum.aufeminin.com/album/D20130705/922708_DFNPE5EYHLZB38PGXSXI3Y1J5IDW3H_hairstyles-for-long-face-shape2_H023948_S.jpg" height="50" width="50"/></td>
            <td><img src="https://moodle.org/pluginfile.php/56521/user/icon/moodleofficial/f2?rev=438779" height="50" width="50"/></td>
          </tr>
          <tr>
            <td><input type="radio" name="answer" value="face_001" /></td>
            <td><input type="radio" name="answer" value="face_002" /></td>
            <td><input type="radio" name="answer" value="face_003" /></td>
            <td><input type="radio" name="answer" value="face_004" /></td>
            <td><input type="radio" name="answer" value="face_005" /></td>
            <td><input type="radio" name="answer" value="face_006" /></td>
            <td><input type="radio" name="answer" value="face_007" /></td>
            <td><input type="radio" name="answer" value="face_008" /></td>
            <td><input type="radio" name="answer" value="face_009" /></td>
            <td><input type="radio" name="answer" value="face_010" /></td>
          </tr>
        </table>
        </td>
      </tr>  
      <tr>
        <td><input type="radio" name="answer" value="new_face" /></td>
        <td>None of the above were true</td>
      </tr>  
    </table>
  <input type='hidden' value='' name='assignmentId' id='assignmentId'/>
  <p><input type='submit' id='submitButton' value='Submit' /></p>
  </form>
'''



