#!/usr/bin/env python

def _get_merged_tracks():
    return [
        # Mona
        [
                {
                    "faces": [
                        {
                            "Genderconfidence": 34,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_0_2.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "2470109b93cc87d8d52c18c39cc6a20b",
                            "GlassesConfidence": 40,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 9,
                            "DarkGlassesConfidence": 12,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 66.6208,
                            "face_id": 1,
                            "Blink": "no",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 26,
                            "Glasses": "No"
                            },
                        {
                            "Genderconfidence": 38,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_0_3.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "2a7297129393d0a70f08cc4ab672d745",
                            "GlassesConfidence": 85,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 255,
                            "DarkGlassesConfidence": 61,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 62.3178,
                            "face_id": 2,
                            "Blink": "no",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 12,
                            "Glasses": "No"
                            },
                        {
                            "Genderconfidence": 33,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_0_4.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "796b65e2fdec46ab6eb716d38a5dd10a",
                            "GlassesConfidence": 40,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 10,
                            "DarkGlassesConfidence": 26,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 65.8241,
                            "face_id": 3,
                            "Blink": "yes",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 47,
                            "Glasses": "No"
                            }
                        ],
                    "visiblity_info": [
                        {
                            "end_frame": 5666,
                            "start_frame": 633
                            },
                        {
                            "end_frame": 8366,
                            "start_frame": 5733
                            }
                        ],
                    "track_id": 0
                    },
                ],
        # Child 1
        [
                {
                    "faces": [
                        {
                            "Genderconfidence": 255,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_1_1.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "e0b4d4acbf962226fb78b94dcc6ec0de",
                            "GlassesConfidence": 36,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 31,
                            "DarkGlassesConfidence": 255,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 59.0595,
                            "face_id": 0,
                            "Blink": "yes",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 100,
                            "Glasses": "No"
                            },
                        {
                            "Genderconfidence": 25,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_1_2.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "91535fe780fb30e1a7ee71df3922d885",
                            "GlassesConfidence": 75,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 54,
                            "DarkGlassesConfidence": 35,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 76.1929,
                            "face_id": 1,
                            "Blink": "no",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 100,
                            "Glasses": "No"
                            },
                        {
                            "Genderconfidence": 50,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_1_3.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "3ddc10d58070ead9639de9cc486b6ba4",
                            "GlassesConfidence": 80,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 81,
                            "DarkGlassesConfidence": 46,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 71.3377,
                            "face_id": 2,
                            "Blink": "no",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 56,
                            "Glasses": "No"
                            },
                        {
                            "Genderconfidence": 48,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_1_4.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "34e05fed65ed8ea7db592d78aa43529e",
                            "GlassesConfidence": 70,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 67,
                            "DarkGlassesConfidence": 30,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 67.2394,
                            "face_id": 3,
                            "Blink": "no",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 83,
                            "Glasses": "No"
                            },
                        {
                            "Genderconfidence": 74,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_1_5.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "06a38b5f10954e68d345a66de8b4057c",
                            "GlassesConfidence": 70,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 72,
                            "DarkGlassesConfidence": 23,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 68.1247,
                            "face_id": 4,
                            "Blink": "no",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 85,
                            "Glasses": "No"
                            }
                        ],
                    "visiblity_info": [
                        {
                            "end_frame": 15533,
                            "start_frame": 833
                            },
                        {
                            "end_frame": 37066,
                            "start_frame": 36433
                            },
                        {
                            "end_frame": 48600,
                            "start_frame": 20000
                            },
                        {
                            "end_frame": 48733,
                            "start_frame": 48666
                            },
                        {
                            "end_frame": 61600,
                            "start_frame": 40533
                            },
                        {
                            "end_frame": 64933,
                            "start_frame": 62000
                            },
                        {
                            "end_frame": 65100,
                            "start_frame": 65000
                            },
                        {
                            "end_frame": 66933,
                            "start_frame": 65333
                            },
                        {
                            "end_frame": 73866,
                            "start_frame": 73500
                            },
                        {
                            "end_frame": 74100,
                            "start_frame": 74000
                            },
                        {
                            "end_frame": 75500,
                            "start_frame": 75333
                            },
                        {
                            "end_frame": 76500,
                            "start_frame": 75666
                            },
                        {
                            "end_frame": 76700,
                            "start_frame": 76666
                            }
                        ],
                    "track_id": 1
                    },
                {
                    "faces": [
                        {
                            "Genderconfidence": 255,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_3_1.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "451581b56c136ded16b73fa52c165845",
                            "GlassesConfidence": 48,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 30,
                            "DarkGlassesConfidence": 255,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 59.6994,
                            "face_id": 0,
                            "Blink": "yes",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 61,
                            "Glasses": "No"
                            },
                        {
                            "Genderconfidence": 43,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_3_2.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "d46150e213c82235339c9444799d59cb",
                            "GlassesConfidence": 46,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 7,
                            "DarkGlassesConfidence": 29,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 66.2533,
                            "face_id": 1,
                            "Blink": "yes",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 88,
                            "Glasses": "No"
                            },
                        {
                            "Genderconfidence": 32,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_3_3.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "bf47c110aff46390e31641f5cc623a80",
                            "GlassesConfidence": 59,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 77,
                            "DarkGlassesConfidence": 19,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 66.9296,
                            "face_id": 2,
                            "Blink": "no",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 65,
                            "Glasses": "No"
                            },
                        {
                            "Genderconfidence": 42,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_3_4.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "b38f4182c2fdbe8e9a50ab335e0cdb87",
                            "GlassesConfidence": 55,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 70,
                            "DarkGlassesConfidence": 44,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 65.6005,
                            "face_id": 3,
                            "Blink": "no",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 82,
                            "Glasses": "No"
                            },
                        {
                            "Genderconfidence": 255,
                            "width": 65,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_3_5.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "ece97a5dfb3562bd72118e9cafbe04d2",
                            "GlassesConfidence": 60,
                            "height": 65,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 90,
                            "DarkGlassesConfidence": 27,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 69.3573,
                            "face_id": 4,
                            "Blink": "no",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 95,
                            "Glasses": "No"
                            }
                        ],
                    "visiblity_info": [
                        {
                            "end_frame": 95733,
                            "start_frame": 83933
                            },
                        {
                            "end_frame": 96733,
                            "start_frame": 96600
                            }
                        ],
                    "track_id": 3
                    },
                ],
        # Child 2
        [
                {
                    "faces": [
                        {
                            "Genderconfidence": 20,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_2_1.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "c87428eda6e41e4760a1517b8402731c",
                            "GlassesConfidence": 43,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 66,
                            "DarkGlassesConfidence": 46,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 62.4248,
                            "face_id": 0,
                            "Blink": "no",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 90,
                            "Glasses": "No"
                            },
                        {
                            "Genderconfidence": 62,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_2_2.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "6ad0dab4710e89335f902ca739d6af35",
                            "GlassesConfidence": 53,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 66,
                            "DarkGlassesConfidence": 23,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 65.7695,
                            "face_id": 1,
                            "Blink": "no",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 45,
                            "Glasses": "No"
                            },
                        {
                            "Genderconfidence": 255,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_2_3.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "9ccb02d540f10c67141a55644c660242",
                            "GlassesConfidence": 43,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 62,
                            "DarkGlassesConfidence": 48,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 60.3161,
                            "face_id": 2,
                            "Blink": "no",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 71,
                            "Glasses": "No"
                            },
                        {
                            "Genderconfidence": 255,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_2_4.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "029ffe1ead992e0d8bb0eaae94253b8d",
                            "GlassesConfidence": 52,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 39,
                            "DarkGlassesConfidence": 27,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 66.6435,
                            "face_id": 3,
                            "Blink": "no",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 88,
                            "Glasses": "No"
                            },
                        {
                            "Genderconfidence": 53,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_2_5.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "a6a2b37a7371bec479a361a3ec27c5e9",
                            "GlassesConfidence": 48,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 79,
                            "DarkGlassesConfidence": 35,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 68.2131,
                            "face_id": 4,
                            "Blink": "no",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 100,
                            "Glasses": "No"
                            }
                        ],
                    "visiblity_info": [
                        {
                            "end_frame": 34266,
                            "start_frame": 19433
                            },
                        {
                            "end_frame": 37600,
                            "start_frame": 26033
                            },
                        {
                            "end_frame": 92566,
                            "start_frame": 37833
                            },
                        {
                            "end_frame": 94000,
                            "start_frame": 92600
                            },
                        {
                            "end_frame": 100366,
                            "start_frame": 94266
                            }
                        ],
                    "track_id": 2
                    },
                {
                    "faces": [
                        {
                            "Genderconfidence": 21,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_4_2.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "94c946a9e6a387401cdf30ef57f681e2",
                            "GlassesConfidence": 21,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 26,
                            "DarkGlassesConfidence": 9,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 53.7607,
                            "face_id": 1,
                            "Blink": "no",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 9,
                            "Glasses": "No"
                            },
                        {
                            "Genderconfidence": 40,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_4_3.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "0da080c8095dc64224a72cfa9e351aa0",
                            "GlassesConfidence": 26,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 16,
                            "DarkGlassesConfidence": 59,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 57.9286,
                            "face_id": 2,
                            "Blink": "no",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 24,
                            "Glasses": "No"
                            },
                        {
                            "Genderconfidence": 255,
                            "width": 64,
                            "s3_key": "12a66e50-3497-11e3-85db-d3cef39baf91/12a66e50-3497-11e3-85db-d3cef39baf91_face_4_4.jpg",
                            "face_rotation_yaw": 0,
                            "s3_bucket": "viblio-uploaded-files",
                            "md5sum": "5696d510136b19f9d86eb961ed97c0de",
                            "GlassesConfidence": 80,
                            "height": 64,
                            "face_rotation_pitch": 0,
                            "DarkGlasses": "No",
                            "Blinkconfidence": 17,
                            "DarkGlassesConfidence": 45,
                            "Gender": "female",
                            "face_rotation_roll": 0,
                            "face_confidence": 53.6297,
                            "face_id": 3,
                            "Blink": "no",
                            "MouthOpen": "Yes",
                            "MouthOpenConfidence": 85,
                            "Glasses": "No"
                            }
                        ],
                    "visiblity_info": [
                        {
                            "end_frame": 100366,
                            "start_frame": 94033
                            }
                        ],
                    "track_id": 4
                    }
                ]
        ]

guess_contact = { 'uuid' : '4dd58749-958c-4fd2-93b6-0e49403c01af', 'picture_uri' : '4dd58749-958c-4fd2-93b6-0e49403c01af/face-3e95a54a-afa4-479b-9893-f5307c71a7df.jpg', 'intellivision_id' : -99.9 }

test_contacts = {
    '7bdcb12f-8a4b-4970-919f-300dc45f8e6e' : { 'picture_uri' : '4dd58749-958c-4fd2-93b6-0e49403c01af/face-01e6ca90-95e2-47c3-a33d-22fa2dd1b413.jpg', 'intellivision_id' : -99.9 },
    '350c353d-96ea-4d2c-a601-8951fdd790e6' : { 'picture_uri' : '4dd58749-958c-4fd2-93b6-0e49403c01af/face-f800b9c8-1f1e-4778-a016-6389200212fb.jpg', 'intellivision_id' : -99.9 },
    'cb6b60d5-cfc2-42c0-877f-e948bdbf654f' : { 'picture_uri' : '4dd58749-958c-4fd2-93b6-0e49403c01af/face-a09ed5db-976b-44b8-bda1-5b0c8f7db2ba.jpg', 'intellivision_id' : -99.9 },
    'ce926853-5621-4a4e-86b2-4758824ba311' : { 'picture_uri' : '4dd58749-958c-4fd2-93b6-0e49403c01af/face-5578fa1c-c948-4f5f-89f1-58ff94ddca33.jpg', 'intellivision_id' : -99.9 },
    '42339711-c033-491a-983b-1ce81ecf010e' : { 'picture_uri' : '4dd58749-958c-4fd2-93b6-0e49403c01af/face-cfddfcf3-0eda-4966-ab5b-933ebcd913a0.jpg', 'intellivision_id' : -99.9 },
    'cbe49436-8e7e-47de-8cd9-adb8215020de' : { 'picture_uri' : '4dd58749-958c-4fd2-93b6-0e49403c01af/face-8d4181d1-bf60-49b7-b0f9-935fae935098.jpg', 'intellivision_id' : -99.9 },
    '0c04b683-fe79-4ab6-93bb-39ac9f096649' : { 'picture_uri' : '4dd58749-958c-4fd2-93b6-0e49403c01af/face-fb82b100-9990-43ab-8803-67946397fd0d.jpg', 'intellivision_id' : -99.9 },
    '4c037dd9-0843-4460-830d-a45b77aaf2f5' : { 'picture_uri' : '4dd58749-958c-4fd2-93b6-0e49403c01af/face-5e65755c-3e6f-47fc-9781-92dc9bb18461.jpg', 'intellivision_id' : -99.9 },
    'dd468776-56c4-4892-8a88-a9651ddbd5a9' : { 'picture_uri' : '4dd58749-958c-4fd2-93b6-0e49403c01af/face-587edda1-7acf-4e7a-a67c-17134adcdf61.jpg', 'intellivision_id' : -99.9 }
    }



form_front = '''
  <form name='mturk_form' method='post' id='mturk_form' action='https://www.mturk.com/mturk/externalSubmit'>
'''

form_back = '''
  <input type='hidden' value='' name='assignmentId' id='assignmentId'/>
  <p><input type='submit' id='submitButton' value='Submit' /></p>
  </form>
'''

html_back = '''
  <script language='Javascript'>turkSetAssignmentID();</script>
 </body>
</html>
]]>
  </HTMLContent>
  <FrameHeight>%d</FrameHeight>
</HTMLQuestion>
'''

html_front = '''<HTMLQuestion xmlns="http://mechanicalturk.amazonaws.com/AWSMechanicalTurkDataSchemas/2011-11-11/HTMLQuestion.xsd">
  <HTMLContent><![CDATA[
<!DOCTYPE html>
<html>
 <head>
  <meta http-equiv='Content-Type' content='text/html; charset=UTF-8'/>
  <script type='text/javascript' src='https://s3.amazonaws.com/mturk-public/externalHIT_v1.js'></script>
  <title>Recognize Faces</title>
 </head>
 <body>

 <p>For the person pictured below, select one answer:</p>
'''

def _get_contact_row_html( contacts, start_idx, cell_count, server ):

    contact_count = len( contacts )

    html = "<tr>"
    for i in range( contact_count ):
        contact_uuid, contact = contacts[i]
        
        html += '<td><img src="%s%s" height="50" width="50" alt="Img. %s" /></td>' % ( server, contact['picture_uri'], start_idx + i )

    for i in range( contact_count, cell_count ):
        html += '<td></td>'

    html += '</tr>'
    html += '<tr>'

    for i in range( contact_count ):
        contact_uuid, contact = contacts[i]
        
        html += '<td><input type="radio" name="answer" value="recognized_%s" /></td>' % ( contact_uuid )

    for i in range( contact_count, cell_count ):
        html += '<td></td>'

    html += '</tr>'

    return html

def _get_question( guess, contacts, person_tracks ):
    html = html_front

    face = person_tracks[0]['faces'][0]
    server = "http://staging.viblio.com/s/ip/"
    if face['s3_bucket'] != "viblio-uploaded-files":
        server = "http://prod.viblio.com/s/ip/"
    
    # Create a table of the person we're recognizing
    html += '<table><tr>'
    for face in person_tracks[0]['faces']:
        html += '<td><img src="%s%s" height="50" width="50" alt="An Image" /></td>' % ( server, face['s3_key'] )
    html += '</tr></table>'
   
    html += form_front

    html += '<table border="1">'

    if guess:
        html += '<tr>'
        html += '<td><input type="radio" name="answer" value="recognized_%s" /></td>' % ( guess['uuid'] )
        html += '<td>The person  is the same as this person: <img src="%s%s" height="50" width="50" alt="Img. %s" /></td>' % ( server, guess['picture_uri'], 'guess' )
        html += '</tr>'

    html += '<tr>'
    html += '<td></td>'
    html += '<td>The person is one of these people:</td>'
    html += '</tr>'

    html += '<tr>'
    html += '<td></td>'
    html += '<td>'

    html += '<table>'
    col_faces = 5

    for idx in range( 0, len( contacts ), col_faces ):
        html += _get_contact_row_html( contacts[idx:idx+col_faces], idx, col_faces, server )
        
    html += '</table>'

    html += '</td>'
    html += '</tr>'

    html += '<tr>'
    html += '<td><input type="radio" name="answer" value="new_face" /></td>'
    html += '<td>The person was none of the above people.</td>'
    html += '</tr>'
    
    html += '</table>'
    html += form_back
    # Parenthesis because of integer division not being associative.
    html += html_back % ( 75*( len( contacts )/col_faces ) + 150 ) 
    
    return html

from vib.thirdParty.mturkcore import MechanicalTurk

mt = MechanicalTurk( 
    { 
        'use_sandbox'           : True, 
        'stdout_log'            : True, 
        'aws_key'     : 'AKIAJHD46VMHB2FBEMMA',
        'aws_secret_key' : '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',
        } 
    )

RecognizeHITTypeId = '2SVYU98JHSTPIHTBQGA9LOBJE7ZDPU'

media_uuid = '1234690'

tracks = _get_merged_tracks()

for person_tracks in tracks:

    create_options = {
        # DEBUG - get this from configuration
        'HITTypeId' : RecognizeHITTypeId,
        'LifetimeInSeconds' : 36*60*60,
        'RequesterAnnotation' : media_uuid,
        'UniqueRequestToken' : 'recognize-' + media_uuid,
        'Question' : _get_question( guess_contact, test_contacts.items(), person_tracks )
        }

    print create_options['Question']
    
    result = mt.create_request( 'CreateHIT', create_options )
    # print "Result was %s" % result

    hit_id = None
    try:
        hit_id = result['CreateHITResponse']['HIT']['HITId']
    except:
        # Handle the case where this hit already exists.
        print "HIT ALREADY EXISTED"
        hit_id = result['CreateHITResponse']['HIT']['Request']['Errors']['Error']['Data'][1]['Value']

    print "Hit id was %s" % hit_id

get_options = {
    'HITId' : hit_id
    }

#result = mt.create_request( 'GetHIT', get_options )
#print "Result was %s" % result

get_assignments_options = {
    'HITId' : hit_id
    }

#assignment = mt.create_request( 'GetAssignmentsForHIT', get_assignments_options )

#answer = result['GetAssignmentsForHITResponse']['GetAssignmentsForHITResult']['Assignment']['Answer']
#answer = mt.get_response_element( 'Answer', assignment )
#answer_dict = xmltodict.parse( answer )

#for answer in answer_dict['QuestionFormAnswers']['Answer']:
#    label = answer['QuestionIdentifier']
#    value = answer['FreeText']

# NOTE: We'll get back merge_track_n for everything except track 0,
# just with a value of None if it wasn't selected.  Typical output:
# merge_track_1 : None
# merge_track_2 : None
# merge_track_3 : 1
# merge_track_4 : 2
# answer_0 : 0_new
# answer_1 : 1_new
# answer_2 : 2_new


def _get_track_html( track ):
    return '''
  <table>
    <tr>
      <td><img src="http://web.cacs.louisiana.edu/~cice/mesh/mary.jpg" height="50" width="50" /></td>
      <td><img src="http://imalbum.aufeminin.com/album/D20130702/hairstyles-for-oval-shaped-faces1-921202_H165451_S.jpg" height="50" width="50" /></td>
      <td><img src="https://si0.twimg.com/profile_images/3528477267/a5d136b09d331805e88d24f69c0d0fdb.jpeg" height="50" width="50" /></td>
      <td><img src="http://31.media.tumblr.com/avatar_8f99bee205d9_64.png" height="50" width="50" /></td>
      <td><img src="http://imalbum.aufeminin.com/album/D20130621/919480_YATQJ5UWKKEBPFBMUSOT8XOYQYADGF_hairstyles-for-square-faces1_H000444_S.jpg" height="50" width="50" /></td>
    </tr>
  </table>
'''


def _get_form_html( tracks ):
    return '''  
    <p>Select the first true statement below:</p>


    <table border="1px">
      <tr>
        <td><input type="radio" name="answer" value="not_face" /></td>
        <td>One of the above images is not a face</td>
      </tr>  
      <tr>
        <td><input type="radio" name="answer" value="two_face" /></td>
        <td>The face images above are of two or more different people.</td>
      </tr>  
      <tr>
        <td><input type="radio" name="answer" value="recognized_face" /></td>
        <td>The images above are of this person:<img src="https://si0.twimg.com/profile_images/378800000060141540/c140d338c308894eb0475045010aeeb5.jpeg" height="50" width="50"/></td>
      </tr>  
      <tr>
        <td></td>
        <td>If the images above are of one of the people below, click the button under the person:</td>
      <tr>
      <tr>
        <td></td>
        <td>
        <table>
          <tr>
            <td><img src="https://si0.twimg.com/profile_images/378800000598797835/996bbcad7ddf2277bd5352dcf165671a_normal.jpeg" height="50" width="50"/></td>
            <td><img src="http://imalbum.aufeminin.com/album/D20130614/hairstyles-for-heartshaped-faces1-918395_H125134_S.jpg" height="50" width="50"/></td>
            <td><img src="https://si0.twimg.com/profile_images/3312497315/4132de7875e8184ff04b432b40fc012f_normal.jpeg" height="50" width="50"/></td>
            <td><img src="https://lh6.googleusercontent.com/-6tvTjoGnBCI/AAAAAAAAAAI/AAAAAAAAAAA/rO4GhBZXLT8/s48-c-k/photo.jpg" height="50" width="50"/></td>
            <td><img src="http://www.cs.indiana.edu/~kinzler/images/kinzler_icon.gif" height="50" width="50"/></td>
            <td><img src="http://web.cacs.louisiana.edu/~cice/mesh/jane.jpg" height="50" width="50"/></td>
            <td><img src="http://s4.evcdn.com/images/block/I0-001/013/818/515-1.jpeg_/many-faces-hildegard-bingen-new-doctor-church-15.jpeg" height="50" width="50"/></td>
            <td><img src="https://lh5.googleusercontent.com/-jCBTc4m12gE/AAAAAAAAAAI/AAAAAAAAAAA/htwrLaSvByU/s48-c-k/photo.jpg" height="50" width="50"/></td>
            <td><img src="http://imalbum.aufeminin.com/album/D20130705/922708_DFNPE5EYHLZB38PGXSXI3Y1J5IDW3H_hairstyles-for-long-face-shape2_H023948_S.jpg" height="50" width="50"/></td>
            <td><img src="https://moodle.org/pluginfile.php/56521/user/icon/moodleofficial/f2?rev=438779" height="50" width="50"/></td>
          </tr>
          <tr>
            <td><input type="radio" name="answer" value="face_001" /></td>
            <td><input type="radio" name="answer" value="face_002" /></td>
            <td><input type="radio" name="answer" value="face_003" /></td>
            <td><input type="radio" name="answer" value="face_004" /></td>
            <td><input type="radio" name="answer" value="face_005" /></td>
            <td><input type="radio" name="answer" value="face_006" /></td>
            <td><input type="radio" name="answer" value="face_007" /></td>
            <td><input type="radio" name="answer" value="face_008" /></td>
            <td><input type="radio" name="answer" value="face_009" /></td>
            <td><input type="radio" name="answer" value="face_010" /></td>
          </tr>
        </table>
        </td>
      </tr>  
      <tr>
        <td><input type="radio" name="answer" value="new_face" /></td>
        <td>None of the above were true</td>
      </tr>  
    </table>
  <input type='hidden' value='' name='assignmentId' id='assignmentId'/>
  <p><input type='submit' id='submitButton' value='Submit' /></p>
  </form>
'''



